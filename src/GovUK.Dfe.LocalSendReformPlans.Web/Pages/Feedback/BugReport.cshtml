@page "/Feedback/BugReport"
@model GovUK.Dfe.LocalSendReformPlans.Web.Pages.Feedback.BugReportModel
@{
    ViewData["Title"] = "What problem did you notice with the form?";
}

@section BeforeContent {
    @if (Model.ReferenceNumber is not null)
    {
        <govuk-back-link href="/Feedback?referenceNumber=@Model.ReferenceNumber"></govuk-back-link>
    }
    else
    {
        <govuk-back-link href="/Feedback">Back</govuk-back-link>
    }
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <form method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" value="@Model.ReferenceNumber" name="@nameof(Model.ReferenceNumber)"/>
            <govuk-character-count name="@nameof(Model.Message)" max-length="2000" label-class="govuk-label--l">
                <govuk-character-count-label>
                    What problem did you notice with the form?
                </govuk-character-count-label>

                <govuk-character-count-hint>
                    If you can, tell us which page you were on and what you were trying to do when you noticed the
                    issue.
                </govuk-character-count-hint>

                @if (!Model.IsPropertyValid(nameof(Model.Message)))
                {
                    <govuk-character-count-error-message>
                        <span class="govuk-visually-hidden">Error:</span>
                        You must give details
                    </govuk-character-count-error-message>
                }

                <govuk-character-count-value>@Model.Message</govuk-character-count-value>
            </govuk-character-count>

            <govuk-radios name="@nameof(Model.AllowContact)">
                <govuk-radios-fieldset>
                    <govuk-radios-fieldset-legend class="govuk-fieldset__legend--m">
                        Would you like to be contacted about the problem?
                    </govuk-radios-fieldset-legend>

                    @if (!Model.IsPropertyValid(nameof(Model.AllowContact)))
                    {
                        <govuk-radios-error-message>
                            <span class="govuk-visually-hidden">Error: </span>
                            You must choose an option
                        </govuk-radios-error-message>
                    }

                    <govuk-radios-item checked="@Model.AllowContact" value="true">
                        Yes
                        <govuk-radios-item-conditional>
                            <govuk-input name="@nameof(Model.EmailAddress)" value="@Model.EmailAddress"
                                         label-class="govuk-label--s" type="email">
                                <govuk-input-label>
                                    What email address would you like to be contacted through?
                                </govuk-input-label>

                                @if (!Model.IsPropertyValid(nameof(Model.EmailAddress)))
                                {
                                    <govuk-input-error-message>
                                        <span class="govuk-visually-hidden">Error: </span>
                                        You must give an email address
                                    </govuk-input-error-message>
                                }
                            </govuk-input>
                        </govuk-radios-item-conditional>
                    </govuk-radios-item>

                    <govuk-radios-item checked="@(!Model.AllowContact)" value="false">
                        No
                    </govuk-radios-item>
                </govuk-radios-fieldset>
            </govuk-radios>

            <input type="submit" value="Submit details"
                   class="govuk-button govuk-!-margin-top-4 govuk-!-margin-bottom-8">
        </form>
    </div>
</div>
